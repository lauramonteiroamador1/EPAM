WITH tmp AS (
	SELECT
		CASE WHEN COLUMN_NAME IS NULL THEN '' ELSE COLUMN_NAME END AS COLUMN_NAME,
		CASE WHEN COLUMN_DEFAULT IS NULL THEN '' ELSE COLUMN_DEFAULT END AS COLUMN_DEFAULT,
		CASE WHEN IS_NULLABLE IS NULL THEN '' ELSE IS_NULLABLE END AS IS_NULLABLE,
		CASE WHEN DATA_TYPE IS NULL THEN '' ELSE DATA_TYPE END AS DATA_TYPE,
		CASE WHEN CHARACTER_MAXIMUM_LENGTH IS NULL THEN '' ELSE to_varchar(CHARACTER_MAXIMUM_LENGTH) END AS CHARACTER_MAXIMUM_LENGTH,
		CASE WHEN NUMERIC_PRECISION IS NULL THEN '' ELSE to_varchar(NUMERIC_PRECISION) END AS NUMERIC_PRECISION,
		CASE WHEN NUMERIC_SCALE IS NULL THEN '' ELSE to_varchar(NUMERIC_SCALE) END AS NUMERIC_SCALE,
		ORDINAL_POSITION 
	FROM INFORMATION_SCHEMA.COLUMNS
	WHERE TABLE_SCHEMA = UPPER('${schema}') and TABLE_NAME = UPPER('${table}')
)
SELECT count(*) AS count FROM (
    SELECT
	COLUMN_NAME,
	COLUMN_DEFAULT,
	IS_NULLABLE,
	DATA_TYPE, 
	to_varchar(CHARACTER_MAXIMUM_LENGTH) AS CHARACTER_MAXIMUM_LENGTH,
	to_varchar(NUMERIC_PRECISION) AS NUMERIC_PRECISION,
	to_varchar(NUMERIC_SCALE) AS NUMERIC_SCALE,
    COUNT(*)
FROM tmp
GROUP BY COLUMN_NAME,
	COLUMN_DEFAULT,
	IS_NULLABLE,
	DATA_TYPE, 
	CHARACTER_MAXIMUM_LENGTH,
	NUMERIC_PRECISION,
	NUMERIC_SCALE
HAVING count(*) > 1 ) 